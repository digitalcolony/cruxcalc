<!DOCTYPE html>
<html>
	<head>
		<title>SharedValues Debug</title>
	</head>
	<body>
		<h1>SharedValues Debug Test</h1>

		<div>
			<label>Height (inches):</label>
			<input
				type="range"
				id="height"
				min="48"
				max="84"
				value="68"
				data-shared-key="heightTotalInches"
			/>
			<span id="height-display">68</span>
		</div>

		<div>
			<label>Weight (lbs):</label>
			<input type="range" id="weight" min="80" max="400" value="160" data-shared-key="weightLbs" />
			<span id="weight-display">160</span>
		</div>

		<div>
			<button onclick="testSave()">Test Save</button>
			<button onclick="testLoad()">Test Load</button>
			<button onclick="showStorage()">Show localStorage</button>
			<button onclick="clearStorage()">Clear localStorage</button>
		</div>

		<div id="output"></div>

		<script src="/sharedValues.js"></script>
		<script>
			let sharedValues;
			const output = document.getElementById("output");

			function log(message) {
				output.innerHTML += "<p>" + message + "</p>";
				console.log(message);
			}

			document.addEventListener("DOMContentLoaded", () => {
				log("DOM loaded");

				if (typeof SharedValues !== "undefined") {
					log("‚úÖ SharedValues is available");
					sharedValues = new SharedValues();
					log("‚úÖ SharedValues instance created");

					// Test basic functionality
					const values = sharedValues.load();
					log("üì¶ Loaded values: " + JSON.stringify(values));
				} else {
					log("‚ùå SharedValues is NOT available");
				}

				// Add event listeners to sliders
				const heightSlider = document.getElementById("height");
				const weightSlider = document.getElementById("weight");

				if (heightSlider) {
					heightSlider.addEventListener("input", (e) => {
						const value = parseFloat(e.target.value);
						document.getElementById("height-display").textContent = value;

						if (sharedValues) {
							sharedValues.set("heightTotalInches", value);
							log(`üíæ Saved height: ${value}`);
						}
					});
				}

				if (weightSlider) {
					weightSlider.addEventListener("input", (e) => {
						const value = parseFloat(e.target.value);
						document.getElementById("weight-display").textContent = value;

						if (sharedValues) {
							sharedValues.set("weightLbs", value);
							log(`üíæ Saved weight: ${value}`);
						}
					});
				}
			});

			function testSave() {
				if (sharedValues) {
					sharedValues.set("heightTotalInches", 72);
					sharedValues.set("weightLbs", 180);
					log("üß™ Test values saved (height: 72, weight: 180)");
				}
			}

			function testLoad() {
				if (sharedValues) {
					const values = sharedValues.load();
					log("üì• Loaded values: " + JSON.stringify(values, null, 2));

					// Update sliders
					const heightSlider = document.getElementById("height");
					const weightSlider = document.getElementById("weight");

					if (values.heightTotalInches && heightSlider) {
						heightSlider.value = values.heightTotalInches;
						document.getElementById("height-display").textContent = values.heightTotalInches;
					}

					if (values.weightLbs && weightSlider) {
						weightSlider.value = values.weightLbs;
						document.getElementById("weight-display").textContent = values.weightLbs;
					}
				}
			}

			function showStorage() {
				const stored = localStorage.getItem("cruxcalc-shared-values");
				log("üóÑÔ∏è localStorage: " + (stored || "null"));
			}

			function clearStorage() {
				localStorage.removeItem("cruxcalc-shared-values");
				log("üóëÔ∏è localStorage cleared");
			}
		</script>
	</body>
</html>
