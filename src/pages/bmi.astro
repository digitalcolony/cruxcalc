---
import Layout from "../layouts/Layout.astro";
import CalculatorLayout from "../components/CalculatorLayout.astro";
import RangeSlider from "../components/RangeSlider.astro";
import UnitToggle from "../components/UnitToggle.astro";
import InputGroup from "../components/InputGroup.astro";
import ResultCard from "../components/ResultCard.astro";
import ResultValue from "../components/ResultValue.astro";
import CategoryBadge from "../components/CategoryBadge.astro";

// Initialize SharedValues on the server side
const sharedValues = {
	heightUnit: "imperial",
	weightUnit: "imperial",
};
---

<Layout
	title="BMI Calculator - Potato Hack Fitness Calculators"
	description="Calculate your Body Mass Index with our modern, interactive BMI calculator. Real-time results with visual indicators."
>
	<CalculatorLayout
		title="BMI Calculator"
		description="Calculate your Body Mass Index with real-time visual feedback"
	>
		<div slot="inputs">
			<InputGroup label="Height" helpText="Choose your preferred measurement system">
				<UnitToggle
					options={[
						{ value: "imperial", label: "ft/in" },
						{ value: "metric", label: "cm" },
					]}
					activeValue={sharedValues.heightUnit}
					dataAttribute="unit"
				/>
			</InputGroup>

			<div class="height-inputs imperial-height" data-unit-group="imperial">
				<InputGroup label="" helpText="" class="full-width">
					<RangeSlider
						id="height-total-inches"
						label=""
						min={48}
						max={84}
						step={0.5}
						value={68}
						unit=""
						sharedKey="heightTotalInches"
						formatAsHeight={true}
					/>
				</InputGroup>
			</div>

			<div class="height-inputs metric-height" data-unit-group="metric" style="display: none;">
				<InputGroup label="" helpText="" class="full-width">
					<RangeSlider
						id="height-cm"
						label=""
						min={120}
						max={220}
						value={173}
						unit="cm"
						sharedKey="heightCm"
					/>
				</InputGroup>
			</div>

			<InputGroup label="Weight" helpText="Choose your preferred measurement system">
				<UnitToggle
					options={[
						{ value: "imperial", label: "lbs" },
						{ value: "metric", label: "kg" },
					]}
					activeValue={sharedValues.weightUnit}
					dataAttribute="unit"
				/>
			</InputGroup>

			<div class="weight-inputs imperial-weight" data-unit-group="imperial">
				<InputGroup label="" helpText="" class="full-width">
					<RangeSlider
						id="weight-lbs"
						label=""
						min={80}
						max={400}
						value={160}
						unit="lbs"
						sharedKey="weightLbs"
					/>
				</InputGroup>
			</div>

			<div class="weight-inputs metric-weight" data-unit-group="metric" style="display: none;">
				<InputGroup label="" helpText="" class="full-width">
					<RangeSlider
						id="weight-kg"
						label=""
						min={35}
						max={180}
						value={73}
						unit="kg"
						sharedKey="weightKg"
					/>
				</InputGroup>
			</div>

			<InputGroup
				label="BMI Scale"
				helpText="Asian populations have different BMI thresholds for health risks"
			>
				<div class="checkbox-container">
					<label class="checkbox-label">
						<input type="checkbox" id="asian-scale" />
						<span class="checkbox-text">Use Asian BMI Scale</span>
					</label>
				</div>
			</InputGroup>
		</div>

		<div slot="results">
			<ResultCard title="Your BMI Result" variant="primary">
				<ResultValue value={22.8} unit="BMI" size="xl" color="primary" id="bmi-number" />
				<div slot="badge">
					<CategoryBadge category="Normal Weight" class="normal" id="bmi-category" />
				</div>
			</ResultCard>

			<div class="bmi-scale">
				<div class="scale-bar">
					<div class="scale-segment underweight">
						<span>Under<br />weight</span>
					</div>
					<div class="scale-segment normal">
						<span>Normal</span>
					</div>
					<div class="scale-segment overweight">
						<span>Over<br />weight</span>
					</div>
					<div class="scale-segment obese">
						<span>Obese</span>
					</div>
				</div>
				<div class="scale-indicator" id="scale-indicator"></div>
			</div>

			<ResultCard title="Understanding Your BMI">
				<p id="bmi-explanation">
					Your BMI falls within the normal weight range. This suggests a healthy weight for your
					height.
				</p>
			</ResultCard>

			<ResultCard title="BMI Scale Comparison">
				<div class="scales-comparison">
					<div class="scale-info">
						<h5>Standard BMI Scale</h5>
						<ul>
							<li>Underweight: &lt; 18.5</li>
							<li>Normal: 18.5 - 24.9</li>
							<li>Overweight: 25.0 - 29.9</li>
							<li>Obese: ≥ 30.0</li>
						</ul>
					</div>
					<div class="scale-info">
						<h5>Asian BMI Scale</h5>
						<ul>
							<li>Underweight: &lt; 18.5</li>
							<li>Normal: 18.5 - 22.9</li>
							<li>Overweight: 23.0 - 27.4</li>
							<li>Obese: ≥ 27.5</li>
						</ul>
					</div>
				</div>
			</ResultCard>
			<p class="scale-note">
				<strong>Why different scales?</strong> Research shows that Asian populations have higher risks
				of diabetes and cardiovascular disease at lower BMI levels. The Asian BMI scale uses lower thresholds
				to better identify health risks in Asian populations.
			</p>
		</div>
	</CalculatorLayout>
</Layout>

<style>
	/* Checkbox styling */
	.checkbox-container {
		margin-bottom: 0.75rem;
	}

	.checkbox-label {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		cursor: pointer;
		font-weight: 500;
		margin-bottom: 0;
		padding: 0.5rem 0;
	}

	.checkbox-label input[type="checkbox"] {
		width: 20px;
		height: 20px;
		accent-color: var(--color-primary);
		cursor: pointer;
		flex-shrink: 0;
	}

	.checkbox-text {
		font-size: 1rem;
		color: var(--color-text);
		font-weight: 500;
	}

	/* BMI Scale Visualization */
	.bmi-scale {
		background: var(--color-surface);
		border: var(--border-width) solid var(--color-border);
		border-radius: var(--border-radius-lg);
		padding: 2rem;
		position: relative;
	}

	.scale-bar {
		display: flex;
		height: 60px;
		border-radius: var(--border-radius);
		overflow: hidden;
		margin-bottom: 1.5rem;
	}

	.scale-segment {
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: center;
		color: white;
		font-weight: 600;
		font-size: 0.875rem;
		text-align: center;
		position: relative;
	}

	.scale-segment.underweight {
		background: #3366ff;
	}
	.scale-segment.normal {
		background: var(--color-success);
	}
	.scale-segment.overweight {
		background: var(--color-warning);
	}
	.scale-segment.obese {
		background: var(--color-danger);
	}

	.scale-indicator {
		position: absolute;
		bottom: 1rem;
		width: 0;
		height: 0;
		border-left: 10px solid transparent;
		border-right: 10px solid transparent;
		border-bottom: 12px solid var(--color-text);
		transform: translateX(-50%);
		transition: left 0.3s ease;
	}

	.bmi-info {
		background: var(--color-background);
		border: var(--border-width) solid var(--color-border);
		border-radius: var(--border-radius-lg);
		padding: 1.5rem;
	}

	.bmi-info h3 {
		margin: 0 0 0.75rem 0;
		color: var(--color-text);
		font-size: 1rem;
		font-weight: 600;
	}

	.bmi-info p {
		margin: 0;
		color: var(--color-text-muted);
		font-size: 0.875rem;
		line-height: 1.5;
	}

	.bmi-scales-info {
		margin-top: 1.5rem;
		padding-top: 1.5rem;
		border-top: 1px solid var(--color-border);
	}

	.bmi-scales-info h4 {
		margin: 0 0 1rem 0;
		color: var(--color-text);
		font-size: 0.9rem;
		font-weight: 600;
	}

	.scales-comparison {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1rem;
		margin-bottom: 1rem;
	}

	.scale-info h5 {
		margin: 0 0 0.5rem 0;
		color: var(--color-primary);
		font-size: 0.8rem;
		font-weight: 600;
	}

	.scale-info ul {
		margin: 0;
		padding-left: 1rem;
		list-style-type: none;
	}

	.scale-info li {
		color: var(--color-text-muted);
		font-size: 0.75rem;
		margin-bottom: 0.25rem;
		position: relative;
	}

	.scale-info li::before {
		content: "•";
		color: var(--color-primary);
		position: absolute;
		left: -0.75rem;
	}

	.scale-note {
		background: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: var(--border-radius);
		padding: 0.75rem;
		margin: 0;
		font-size: 0.75rem;
		line-height: 1.4;
	}

	.scale-note strong {
		color: var(--color-text);
	}

	/* Mobile Responsiveness */
	@media (max-width: 768px) {
		.calculator-layout {
			grid-template-columns: 1fr;
			gap: 2rem;
		}

		.calculator-header h1 {
			font-size: 2rem;
		}

		.scales-comparison {
			grid-template-columns: 1fr;
			gap: 0.75rem;
		}

		.checkbox-text {
			font-size: 0.9rem;
		}
	}
</style>

<script src="/sharedValues.js" is:inline></script>
<script>
	// Extend Window interface for SharedValues
	declare global {
		interface Window {
			SharedValues: any;
			bmiCalculator: BMICalculator;
		}
	}

	// BMI Calculator with Component Integration
	class BMICalculator {
		private sharedValues: any;
		private bmiNumber: HTMLElement | null = null;
		private bmiCategory: HTMLElement | null = null;
		private bmiExplanation: HTMLElement | null = null;
		private scaleIndicator: HTMLElement | null = null;
		private asianScale: HTMLInputElement | null = null;

		constructor() {
			this.sharedValues = new (window as any).SharedValues();
			this.initializeElements();
			this.loadSharedValues();
			this.attachEventListeners();
			this.calculate();
		}

		private initializeElements(): void {
			// Result display elements
			this.bmiNumber = document.getElementById("bmi-number");
			this.bmiCategory = document.getElementById("bmi-category");
			this.bmiExplanation = document.getElementById("bmi-explanation");
			this.scaleIndicator = document.getElementById("scale-indicator");
			this.asianScale = document.getElementById("asian-scale") as HTMLInputElement;
		}

		private loadSharedValues(): void {
			const values = this.sharedValues.load();
			console.log("BMI Calculator - Loaded SharedValues:", values);

			// Load Asian scale preference
			if (this.asianScale) {
				this.asianScale.checked = values.useAsianBMI || false;
			}

			// Initialize unit toggles and update sliders immediately
			this.initializeUnitToggles(values);

			// Show appropriate input containers
			this.showCurrentUnitInputs();

			// Force refresh of all range sliders after a short delay to ensure they load saved values
			setTimeout(() => {
				this.updateRangeSliders(values);
			}, 50);
		}

		private initializeUnitToggles(values: any): void {
			console.log("Initializing unit toggles with values:", values);

			// Find and update height unit toggle
			const heightToggle = document.querySelector(
				'.input-group:has(label[for="height"]) .unit-toggle'
			);
			if (heightToggle) {
				const heightButtons = heightToggle.querySelectorAll(".unit-btn");
				heightButtons.forEach((btn) => {
					btn.classList.remove("active");
					if (btn.getAttribute("data-unit") === values.heightUnit) {
						btn.classList.add("active");
						console.log("Set height unit toggle to:", values.heightUnit);
					}
				});
			}

			// Find and update weight unit toggle
			const weightToggle = document.querySelector(
				'.input-group:has(label[for="weight"]) .unit-toggle'
			);
			if (weightToggle) {
				const weightButtons = weightToggle.querySelectorAll(".unit-btn");
				weightButtons.forEach((btn) => {
					btn.classList.remove("active");
					if (btn.getAttribute("data-unit") === values.weightUnit) {
						btn.classList.add("active");
						console.log("Set weight unit toggle to:", values.weightUnit);
					}
				});
			}

			// Update the range sliders to show current values
			this.updateRangeSliders(values);
		}

		private updateRangeSliders(values: any): void {
			console.log("Updating range sliders with values:", values);

			// Find all range sliders and trigger their update
			const rangeSliders = document.querySelectorAll(".range-slider");
			rangeSliders.forEach((slider) => {
				// Dispatch a custom event to tell the slider to refresh from SharedValues
				slider.dispatchEvent(
					new CustomEvent("refresh-from-shared-values", {
						bubbles: true,
					})
				);
			});
		}

		private showCurrentUnitInputs(): void {
			const values = this.sharedValues.load();

			// Show/hide height inputs based on current unit
			const heightInputs = document.querySelectorAll(".height-inputs");
			heightInputs.forEach((input) => {
				const htmlInput = input as HTMLElement;
				if (input.classList.contains(`${values.heightUnit}-height`)) {
					htmlInput.style.display = "block";
				} else {
					htmlInput.style.display = "none";
				}
			});

			// Show/hide weight inputs based on current unit
			const weightInputs = document.querySelectorAll(".weight-inputs");
			weightInputs.forEach((input) => {
				const htmlInput = input as HTMLElement;
				if (input.classList.contains(`${values.weightUnit}-weight`)) {
					htmlInput.style.display = "block";
				} else {
					htmlInput.style.display = "none";
				}
			});
		}

		private attachEventListeners(): void {
			// Listen for unit toggle changes
			document.addEventListener("unit-toggle-change", (event) => {
				this.handleUnitChange(event as CustomEvent);
			});

			// Listen for range slider changes (from our components)
			document.addEventListener("range-slider-change", () => {
				this.calculate();
			});

			// Asian scale checkbox
			if (this.asianScale) {
				this.asianScale.addEventListener("change", () => {
					this.sharedValues.set("useAsianBMI", this.asianScale?.checked);
					this.calculate();
				});
			}
		}

		private handleUnitChange(event: CustomEvent): void {
			console.log("Unit change event received:", event.detail);

			if (event.detail.attribute === "unit") {
				// Get the unit toggle that dispatched this event
				const unitToggle = event.target as HTMLElement;
				const inputGroup = unitToggle?.closest(".input-group");

				if (!inputGroup) {
					console.error("Could not find input group for unit toggle");
					return;
				}

				const label = inputGroup.querySelector("label");
				if (!label) {
					console.error("Could not find label in input group");
					return;
				}

				const labelText = label.textContent?.toLowerCase() || "";
				console.log("Label text:", labelText, "New value:", event.detail.value);

				if (labelText.includes("height")) {
					console.log("Updating height unit to:", event.detail.value);
					this.sharedValues.set("heightUnit", event.detail.value);
					if (event.detail.value === "metric") {
						this.sharedValues.syncHeightUnits("metric");
					} else {
						this.sharedValues.syncHeightUnits("imperial");
					}
				} else if (labelText.includes("weight")) {
					console.log("Updating weight unit to:", event.detail.value);
					this.sharedValues.set("weightUnit", event.detail.value);
					if (event.detail.value === "metric") {
						this.sharedValues.syncWeightUnits("metric");
					} else {
						this.sharedValues.syncWeightUnits("imperial");
					}
				}

				// Refresh range sliders to show converted values
				this.updateRangeSliders(this.sharedValues.load());
				this.showCurrentUnitInputs();
				this.calculate();
			}
		}

		public calculate(): void {
			const values = this.sharedValues.load();
			let heightInMeters, weightInKg;

			// Convert height to meters
			if (values.heightUnit === "imperial") {
				const totalInches = values.heightTotalInches || 68;
				heightInMeters = totalInches * 0.0254;
			} else {
				heightInMeters = values.heightCm / 100;
			}

			// Convert weight to kg
			if (values.weightUnit === "imperial") {
				weightInKg = values.weightLbs * 0.453592;
			} else {
				weightInKg = values.weightKg;
			}

			const bmi = weightInKg / (heightInMeters * heightInMeters);
			this.updateDisplay(bmi, values.useAsianBMI || false);
		}

		private updateDisplay(bmi: number, useAsianScale: boolean): void {
			const category = this.getBMICategory(bmi, useAsianScale);
			const categoryData = this.getCategoryData(category, useAsianScale);

			// Update BMI number (find the span inside the result-value component)
			if (this.bmiNumber) {
				const numberSpan = this.bmiNumber.querySelector(".result-value__number");
				if (numberSpan) {
					numberSpan.textContent = bmi.toFixed(1);
				}
			}

			// Update BMI category
			if (this.bmiCategory) {
				this.bmiCategory.textContent = categoryData.name;
				// Update the CSS class for the category badge
				this.bmiCategory.className = `category-badge category-badge--md category-badge--solid ${category}`;
			}

			if (this.bmiExplanation) {
				this.bmiExplanation.textContent = categoryData.explanation;
			}

			this.updateScaleIndicator(bmi, useAsianScale);
		}

		private getBMICategory(bmi: number, useAsianScale: boolean): string {
			if (useAsianScale) {
				if (bmi < 18.5) return "underweight";
				if (bmi < 23) return "normal";
				if (bmi < 27.5) return "overweight";
				return "obese";
			} else {
				if (bmi < 18.5) return "underweight";
				if (bmi < 25) return "normal";
				if (bmi < 30) return "overweight";
				return "obese";
			}
		}

		private getCategoryData(category: string, useAsianScale: boolean): any {
			const categories = {
				underweight: {
					name: "Underweight",
					color: "#3366ff",
					explanation:
						"Your BMI indicates you may be underweight. Consider consulting with a healthcare provider about healthy weight gain strategies.",
				},
				normal: {
					name: "Normal Weight",
					color: "var(--color-success)",
					explanation: useAsianScale
						? "Your BMI falls within the normal weight range for Asian populations. This suggests a healthy weight for your height."
						: "Your BMI falls within the normal weight range. This suggests a healthy weight for your height.",
				},
				overweight: {
					name: "Overweight",
					color: "var(--color-warning)",
					explanation: useAsianScale
						? "Your BMI indicates you may be overweight according to Asian BMI standards. Consider consulting with a healthcare provider about healthy weight management."
						: "Your BMI indicates you may be overweight. Consider consulting with a healthcare provider about healthy weight management.",
				},
				obese: {
					name: "Obese",
					color: "var(--color-danger)",
					explanation: useAsianScale
						? "Your BMI indicates obesity according to Asian BMI standards. We recommend consulting with a healthcare provider for personalized advice."
						: "Your BMI indicates obesity. We recommend consulting with a healthcare provider for personalized advice.",
				},
			};

			return categories[category as keyof typeof categories];
		}

		private updateScaleIndicator(bmi: number, useAsianScale: boolean): void {
			if (!this.scaleIndicator) return;

			let position;
			if (useAsianScale) {
				// Asian scale thresholds
				if (bmi < 18.5) position = (bmi / 18.5) * 25;
				else if (bmi < 23) position = 25 + ((bmi - 18.5) / 4.5) * 25;
				else if (bmi < 27.5) position = 50 + ((bmi - 23) / 4.5) * 25;
				else position = 75 + Math.min(((bmi - 27.5) / 7.5) * 25, 25);
			} else {
				// Standard scale thresholds
				if (bmi < 18.5) position = (bmi / 18.5) * 25;
				else if (bmi < 25) position = 25 + ((bmi - 18.5) / 6.5) * 25;
				else if (bmi < 30) position = 50 + ((bmi - 25) / 5) * 25;
				else position = 75 + Math.min(((bmi - 30) / 10) * 25, 25);
			}

			this.scaleIndicator.style.left = `${Math.min(position, 100)}%`;
		}
	}

	// Initialize BMI calculator when DOM is ready
	document.addEventListener("DOMContentLoaded", () => {
		// Ensure SharedValues is available
		if (typeof (window as any).SharedValues === "undefined") {
			console.error("SharedValues not loaded");
			return;
		}

		const sharedValues = new (window as any).SharedValues();
		const values = sharedValues.load();

		console.log("Initializing BMI page with values:", values);

		// Initialize unit toggles first - ensure at least one button is active
		function initializeUnitToggles() {
			// Height unit toggle
			const heightButtons = document.querySelectorAll(
				'.input-group:has(label[for="height"]) .unit-btn'
			);
			let heightActiveSet = false;
			heightButtons.forEach((btn) => {
				btn.classList.remove("active");
				if (btn.getAttribute("data-unit") === values.heightUnit) {
					btn.classList.add("active");
					heightActiveSet = true;
				}
			});
			if (!heightActiveSet && heightButtons.length > 0) {
				heightButtons[0].classList.add("active");
				sharedValues.set("heightUnit", heightButtons[0].getAttribute("data-unit"));
			}

			// Weight unit toggle
			const weightButtons = document.querySelectorAll(
				'.input-group:has(label[for="weight"]) .unit-btn'
			);
			let weightActiveSet = false;
			weightButtons.forEach((btn) => {
				btn.classList.remove("active");
				if (btn.getAttribute("data-unit") === values.weightUnit) {
					btn.classList.add("active");
					weightActiveSet = true;
				}
			});
			if (!weightActiveSet && weightButtons.length > 0) {
				weightButtons[0].classList.add("active");
				sharedValues.set("weightUnit", weightButtons[0].getAttribute("data-unit"));
			}
		}

		// Show/hide appropriate input containers based on units
		function showCurrentUnitInputs() {
			const currentValues = sharedValues.load();

			// Height inputs
			document.querySelectorAll(".height-inputs").forEach((input) => {
				const htmlInput = input as HTMLElement;
				if (input.classList.contains(`${currentValues.heightUnit}-height`)) {
					htmlInput.style.display = "block";
				} else {
					htmlInput.style.display = "none";
				}
			});

			// Weight inputs
			document.querySelectorAll(".weight-inputs").forEach((input) => {
				const htmlInput = input as HTMLElement;
				if (input.classList.contains(`${currentValues.weightUnit}-weight`)) {
					htmlInput.style.display = "block";
				} else {
					htmlInput.style.display = "none";
				}
			});
		}

		// Update range sliders with current values
		function updateRangeSliders() {
			const currentValues = sharedValues.load();
			const sliderUpdates = [
				{ id: "height-total-inches", key: "heightTotalInches" },
				{ id: "height-cm", key: "heightCm" },
				{ id: "weight-lbs", key: "weightLbs" },
				{ id: "weight-kg", key: "weightKg" },
			];

			sliderUpdates.forEach(({ id, key }) => {
				const slider = document.getElementById(id) as HTMLInputElement;
				const display = document.getElementById(id + "-display");
				if (slider && currentValues[key] !== undefined) {
					slider.value = currentValues[key];
					if (display) {
						const value = parseFloat(currentValues[key]);

						// Special handling for height-total-inches (formatAsHeight)
						if (id === "height-total-inches") {
							const feet = Math.floor(value / 12);
							const inches = Math.round((value % 12) * 2) / 2;
							display.textContent = `${feet}'${inches}"`;
						} else {
							// Standard formatting
							const step = parseFloat(slider.step || "1");
							if (step < 1) {
								const decimalPlaces = step.toString().split(".")[1]?.length || 1;
								display.textContent = value.toFixed(decimalPlaces);
							} else {
								display.textContent = Math.round(value).toString();
							}
						}
					}
				}
			});
		}

		// Initialize everything
		setTimeout(() => {
			initializeUnitToggles();
			showCurrentUnitInputs();
			updateRangeSliders();

			// Initialize BMI calculator
			(window as any).bmiCalculator = new BMICalculator();
		}, 200);

		// Handle unit toggle changes
		document.addEventListener("unit-toggle-change", function (event: Event) {
			const customEvent = event as CustomEvent;
			console.log("Unit toggle change detected:", customEvent.detail);

			if (customEvent.detail.attribute === "unit") {
				const unitToggle = customEvent.target as HTMLElement;
				const inputGroup = unitToggle?.closest(".input-group");
				const label = inputGroup?.querySelector("label");
				const labelText = label?.textContent?.toLowerCase() || "";

				if (labelText.includes("height")) {
					console.log("Updating height unit to:", customEvent.detail.value);
					sharedValues.set("heightUnit", customEvent.detail.value);
					if (customEvent.detail.value === "metric") {
						sharedValues.syncHeightUnits("metric");
					} else {
						sharedValues.syncHeightUnits("imperial");
					}
				} else if (labelText.includes("weight")) {
					console.log("Updating weight unit to:", customEvent.detail.value);
					sharedValues.set("weightUnit", customEvent.detail.value);
					if (customEvent.detail.value === "metric") {
						sharedValues.syncWeightUnits("metric");
					} else {
						sharedValues.syncWeightUnits("imperial");
					}
				}

				// Refresh everything
				showCurrentUnitInputs();
				updateRangeSliders();

				// Trigger BMI recalculation if calculator exists
				if ((window as any).bmiCalculator && (window as any).bmiCalculator.calculate) {
					(window as any).bmiCalculator.calculate();
				}
			}
		});
	});
</script>
