<!DOCTYPE html>
<html>
	<head>
		<title>BMI Unit Switching Test</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				padding: 20px;
			}
			.test-result {
				margin: 10px 0;
				padding: 10px;
				border-radius: 4px;
			}
			.success {
				background-color: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
			}
			.error {
				background-color: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}
			.info {
				background-color: #d1ecf1;
				color: #0c5460;
				border: 1px solid #bee5eb;
			}
		</style>
	</head>
	<body>
		<h1>BMI Calculator Unit Switching Test</h1>
		<div id="test-results"></div>

		<script>
			function addTestResult(message, type = "info") {
				const div = document.createElement("div");
				div.className = `test-result ${type}`;
				div.textContent = message;
				document.getElementById("test-results").appendChild(div);
			}

			// Test the SharedValues functionality
			async function testSharedValues() {
				try {
					// Load the SharedValues script
					const response = await fetch("/sharedValues.js");
					const scriptContent = await response.text();

					// Create a script element and load it
					const script = document.createElement("script");
					script.textContent = scriptContent;
					document.head.appendChild(script);

					addTestResult("✓ SharedValues script loaded successfully", "success");

					// Test basic functionality
					if (typeof window.SharedValues !== "undefined") {
						addTestResult("✓ SharedValues class is available", "success");

						// Create an instance
						const sharedValues = new window.SharedValues();
						addTestResult("✓ SharedValues instance created", "success");

						// Test setting and getting values
						sharedValues.set("testHeight", 70);
						const testHeight = sharedValues.get("testHeight");

						if (testHeight === 70) {
							addTestResult("✓ SharedValues set/get functionality works", "success");
						} else {
							addTestResult("✗ SharedValues set/get functionality failed", "error");
						}

						// Test unit conversion functions
						if (typeof sharedValues.syncHeightUnits === "function") {
							addTestResult("✓ syncHeightUnits function is available", "success");
						} else {
							addTestResult("✗ syncHeightUnits function not found", "error");
						}

						if (typeof sharedValues.syncWeightUnits === "function") {
							addTestResult("✓ syncWeightUnits function is available", "success");
						} else {
							addTestResult("✗ syncWeightUnits function not found", "error");
						}
					} else {
						addTestResult("✗ SharedValues class not available", "error");
					}
				} catch (error) {
					addTestResult(`✗ Error loading SharedValues: ${error.message}`, "error");
				}
			}

			// Test if the BMI page loads correctly
			async function testBMIPageLoad() {
				try {
					const response = await fetch("/bmi");
					if (response.ok) {
						addTestResult("✓ BMI page loads successfully", "success");
						const html = await response.text();

						// Check for key components and scripts
						if (html.includes("UnitToggle")) {
							addTestResult("✓ UnitToggle components found in BMI page", "success");
						} else {
							addTestResult("✗ UnitToggle components not found in BMI page", "error");
						}

						if (html.includes("RangeSlider")) {
							addTestResult("✓ RangeSlider components found in BMI page", "success");
						} else {
							addTestResult("✗ RangeSlider components not found in BMI page", "error");
						}

						// Check for script loading (the initialization code is in separate modules)
						if (
							html.includes("sharedValues.js") ||
							html.includes("bmi.astro?astro&type=script") ||
							html.includes("setTimeout")
						) {
							addTestResult("✓ Initialization scripts found in BMI page", "success");
						} else {
							addTestResult("✗ Initialization scripts not found in BMI page", "error");
						}
					} else {
						addTestResult(`✗ BMI page failed to load: ${response.status}`, "error");
					}
				} catch (error) {
					addTestResult(`✗ Error testing BMI page: ${error.message}`, "error");
				}
			}

			// Run tests
			addTestResult("Starting BMI Calculator Unit Switching Tests...", "info");
			testSharedValues();
			testBMIPageLoad();
		</script>
	</body>
</html>
